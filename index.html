<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kalkulator Faraid</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<div class="container py-4">
    <div class="card shadow-lg">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Kalkulator Faraid</h3>
        </div>
        <div class="card-body">
            <form id="faraidForm" class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Jumlah Harta (RM)</label>
                    <input type="number" id="harta" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Pasangan</label>
                    <select id="pasangan" class="form-select">
                        <option value="tiada">Tiada</option>
                        <option value="suami">Suami</option>
                        <option value="isteri">Isteri</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Anak Lelaki</label>
                    <input type="number" id="anakLelaki" class="form-control" value="0">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Anak Perempuan</label>
                    <input type="number" id="anakPerempuan" class="form-control" value="0">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Ibu</label>
                    <select id="ibu" class="form-select">
                        <option value="tiada">Tiada</option>
                        <option value="ada">Ada</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Bapa</label>
                    <select id="bapa" class="form-select">
                        <option value="tiada">Tiada</option>
                        <option value="ada">Ada</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Datuk</label>
                    <select id="datuk" class="form-select">
                        <option value="tiada">Tiada</option>
                        <option value="ada">Ada</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Nenek</label>
                    <select id="nenek" class="form-select">
                        <option value="tiada">Tiada</option>
                        <option value="ada">Ada</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Adik-beradik Lelaki</label>
                    <input type="number" id="adikLelaki" class="form-control" value="0">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Adik-beradik Perempuan</label>
                    <input type="number" id="adikPerempuan" class="form-control" value="0">
                </div>
                <div class="col-12 text-center mt-3">
                    <button type="submit" class="btn btn-success btn-lg">Kira Faraid</button>
                </div>
            </form>
        </div>
    </div>

    <div id="hasilSection" class="mt-4" style="display:none;">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0">Keputusan</h4>
            </div>
            <div class="card-body">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Waris</th>
                            <th>Jumlah (RM)</th>
                            <th>Peratus (%)</th>
                        </tr>
                    </thead>
                    <tbody id="hasilTable"></tbody>
                </table>
            </div>
        </div>
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h4 class="mb-0">Carta Pembahagian</h4>
            </div>
            <div class="card-body">
                <canvas id="faraidChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById("faraidForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const harta = parseFloat(document.getElementById("harta").value) || 0;
    const pasangan = document.getElementById("pasangan").value;
    const anakLelaki = parseInt(document.getElementById("anakLelaki").value) || 0;
    const anakPerempuan = parseInt(document.getElementById("anakPerempuan").value) || 0;
    const ibu = document.getElementById("ibu").value;
    const bapa = document.getElementById("bapa").value;
    const datuk = document.getElementById("datuk").value;
    const nenek = document.getElementById("nenek").value;
    const adikLelaki = parseInt(document.getElementById("adikLelaki").value) || 0;
    const adikPerempuan = parseInt(document.getElementById("adikPerempuan").value) || 0;

    let pembahagian = {};

    // Pasangan
    if (pasangan === "suami") pembahagian["Suami"] = (anakLelaki > 0 || anakPerempuan > 0) ? harta * 0.25 : harta * 0.5;
    if (pasangan === "isteri") pembahagian["Isteri"] = (anakLelaki > 0 || anakPerempuan > 0) ? harta * 0.125 : harta * 0.25;

    // Ibu & Bapa
    if (ibu === "ada") pembahagian["Ibu"] = (anakLelaki > 0 || anakPerempuan > 0) ? harta * (1/6) : harta * (1/3);
    if (bapa === "ada") pembahagian["Bapa"] = (anakLelaki > 0 || anakPerempuan > 0) ? harta * (1/6) : harta * (1/3);

    // Datuk & Nenek (jika bapa/ibu tiada)
    if (bapa === "tiada" && datuk === "ada") pembahagian["Datuk"] = harta * (1/6);
    if (ibu === "tiada" && nenek === "ada") pembahagian["Nenek"] = harta * (1/6);

    // Anak (2:1 lelaki:perempuan)
    if (anakLelaki > 0 || anakPerempuan > 0) {
        let baki = harta - Object.values(pembahagian).reduce((a,b) => a+b, 0);
        let bahagianLelaki = anakLelaki * 2;
        let bahagianPerempuan = anakPerempuan;
        let jumlahBahagian = bahagianLelaki + bahagianPerempuan;
        if (anakLelaki > 0) pembahagian["Anak Lelaki"] = (baki / jumlahBahagian) * (anakLelaki * 2);
        if (anakPerempuan > 0) pembahagian["Anak Perempuan"] = (baki / jumlahBahagian) * anakPerempuan;
    }

    // Jika tiada anak, tiada ibu bapa, maka adik-beradik dapat (2:1 juga)
    if (anakLelaki === 0 && anakPerempuan === 0 && ibu === "tiada" && bapa === "tiada" && datuk === "tiada" && nenek === "tiada") {
        if (adikLelaki > 0 || adikPerempuan > 0) {
            let bahagianLelaki = adikLelaki * 2;
            let bahagianPerempuan = adikPerempuan;
            let jumlahBahagian = bahagianLelaki + bahagianPerempuan;
            if (adikLelaki > 0) pembahagian["Adik-beradik Lelaki"] = (harta / jumlahBahagian) * (adikLelaki * 2);
            if (adikPerempuan > 0) pembahagian["Adik-beradik Perempuan"] = (harta / jumlahBahagian) * adikPerempuan;
        } else {
            pembahagian["Baitulmal"] = harta;
        }
    }

    // Papar hasil
    let hasilTable = document.getElementById("hasilTable");
    hasilTable.innerHTML = "";
    let labels = [];
    let data = [];

    for (let waris in pembahagian) {
        let jumlah = pembahagian[waris];
        let peratus = (jumlah / harta * 100).toFixed(2);
        hasilTable.innerHTML += `<tr><td>${waris}</td><td>${jumlah.toFixed(2)}</td><td>${peratus}</td></tr>`;
        labels.push(waris);
        data.push(jumlah);
    }

    document.getElementById("hasilSection").style.display = "block";

    // Carta
    if (window.faraidChartInstance) window.faraidChartInstance.destroy();
    let ctx = document.getElementById("faraidChart").getContext("2d");
    window.faraidChartInstance = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: ['#007bff','#28a745','#ffc107','#dc3545','#6c757d','#17a2b8','#6610f2','#fd7e14']
            }]
        }
    });
});
</script>

</body>
</html>
